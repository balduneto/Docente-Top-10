<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classificação Geral - Docentes com Critérios</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .apexcharts-tooltip {
            background: #FFFFFF !important;
            border: 1px solid #E2E8F0 !important;
            color: #1A202C;
        }
        .apexcharts-tooltip-title {
            background: #F9FAFB !important;
            border-bottom: 1px solid #E2E8F0 !important;
            font-weight: 600;
        }
         .tooltip-grid {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 4px 16px;
            font-size: 12px;
        }
        .tooltip-label {
            font-weight: 600;
            color: #6B7280;
        }
        .tooltip-value {
            font-weight: 500;
            text-align: right;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-7xl bg-white rounded-2xl shadow-2xl p-6 md:p-8">
        <div class="text-center mb-6">
            <div class="flex justify-center mb-4">
                <img src="https://i.postimg.cc/x1pYp13c/det-fieg.png" alt="Logomarca FIEG" class="h-16">
            </div>
            <h1 class="text-2xl md:text-3xl font-bold text-gray-900">Análise de Desempenho de Docentes</h1>
            <p class="text-gray-600 mt-2">Classificação Top 10 com aplicação de critérios de paridade e limite por unidade.</p>
        </div>

        <!-- Cards com Grandes Números -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10 text-white">
            <!-- Card Total de Docentes -->
            <div class="bg-indigo-500 p-6 rounded-xl shadow-lg transform transition-transform hover:scale-105 flex items-center">
                <div class="mr-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-indigo-200" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z" />
                    </svg>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-indigo-100">Docentes Participantes</h3>
                    <p id="total-docentes" class="text-4xl font-bold">0</p>
                </div>
            </div>
            <!-- Card Total de Unidades -->
            <div class="bg-teal-500 p-6 rounded-xl shadow-lg transform transition-transform hover:scale-105 flex items-center">
                <div class="mr-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-teal-200" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a1 1 0 110 2h-3a1 1 0 01-1-1v-2a1 1 0 00-1-1H9a1 1 0 00-1 1v2a1 1 0 01-1 1H4a1 1 0 110-2V4zm3 1h2v2H7V5zm2 4H7v2h2V9zm2-4h2v2h-2V5zm2 4h-2v2h2V9z" clip-rule="evenodd" />
                    </svg>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-teal-100">Unidades Envolvidas</h3>
                    <p id="total-unidades" class="text-4xl font-bold">0</p>
                </div>
            </div>
            <!-- Card Média por Unidade -->
            <div class="bg-gray-700 p-6 rounded-xl shadow-lg transform transition-transform hover:scale-105 flex items-center">
                <div class="mr-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-gray-300" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M2 10a8 8 0 018-8v8h8a8 8 0 11-16 0z" />
                        <path d="M12 2.252A8.014 8.014 0 0117.748 8H12V2.252z" />
                    </svg>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-gray-200">Média por Unidade</h3>
                    <p id="media-unidades" class="text-4xl font-bold">0,0</p>
                </div>
            </div>
        </div>
        
        <!-- Filtros -->
        <div class="flex flex-col md:flex-row md:space-x-4 mb-8">
            <div class="w-full md:w-1/3 mb-4 md:mb-0">
                <label for="unit-filter" class="block text-sm font-medium text-gray-700 mb-2">Filtrar por Unidade:</label>
                <select id="unit-filter" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                    <option value="all">Todas as Unidades</option>
                </select>
            </div>
            <div class="w-full md:w-2/3">
                <label for="teacher-search" class="block text-sm font-medium text-gray-700 mb-2">Buscar Docente:</label>
                <input type="text" id="teacher-search" list="teacher-datalist" placeholder="Digite o nome do docente para buscar..." class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                <datalist id="teacher-datalist"></datalist>
            </div>
        </div>


        <div id="chart-container">
            <div id="chart"></div>
        </div>
        <div class="flex flex-wrap justify-center items-center space-x-4 mt-6 text-sm text-gray-600">
            <div class="flex items-center m-1"><span class="h-3 w-3 rounded-full bg-green-500 mr-2"></span>TOP 10 (SESI)</div>
            <div class="flex items-center m-1"><span class="h-3 w-3 rounded-full bg-blue-500 mr-2"></span>TOP 10 (SENAI)</div>
            <div class="flex items-center m-1"><span class="h-3 w-3 rounded-full bg-gray-500 mr-2"></span>Desclassificado</div>
        </div>
        
        <!-- Seção de Análise Individual -->
        <div class="mt-12 pt-8 border-t border-gray-200">
            <h2 class="text-xl md:text-2xl font-bold text-gray-900 text-center mb-6">Análise Individual de Desempenho</h2>
            <div class="max-w-md mx-auto">
                <label for="individual-teacher-selector" class="block text-sm font-medium text-gray-700 mb-2">Selecione um Docente:</label>
                <select id="individual-teacher-selector" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                    <option value="">-- Escolha um docente --</option>
                </select>
            </div>

            <!-- Card de Performance Individual -->
            <div id="performance-card-container" class="mt-8 max-w-2xl mx-auto hidden">
                <!-- Card content will be injected here by JS -->
            </div>
        </div>


        <!-- Seção de Critérios de Avaliação -->
        <div class="mt-12 pt-8 border-t border-gray-200">
            <h2 class="text-xl md:text-2xl font-bold text-gray-900 text-center mb-6">Critérios de Avaliação</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                
                <div class="bg-gray-50 rounded-lg p-4 flex flex-col justify-between" id="card-n1">
                    <div>
                        <div class="flex justify-between items-start">
                            <h3 class="font-bold text-gray-800">N1: Formação UNINDÚSTRIA</h3>
                            <span class="bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded-full">10 Pts</span>
                        </div>
                        <p class="text-sm text-gray-600 mt-2">Cursos da plataforma Unindústria. Cursos específicos valem 1 ponto cada. Outros cursos (≥ 20h) também são aceitos.</p>
                    </div>
                    <div id="destaque-n1" class="mt-3 pt-3 border-t border-gray-200 text-xs"></div>
                </div>

                <div class="bg-gray-50 rounded-lg p-4 flex flex-col justify-between" id="card-n2">
                    <div>
                        <div class="flex justify-between items-start">
                            <h3 class="font-bold text-gray-800">N2: Formação Externa</h3>
                            <span class="bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded-full">10 Pts</span>
                        </div>
                        <p class="text-sm text-gray-600 mt-2">Certificados de cursos (≥ 40h) em outras instituições, relacionados à área da Educação. Válidos de 01/01/2023 a 30/09/2025.</p>
                    </div>
                    <div id="destaque-n2" class="mt-3 pt-3 border-t border-gray-200 text-xs"></div>
                </div>

                <div class="bg-gray-50 rounded-lg p-4 flex flex-col justify-between" id="card-n3">
                    <div>
                        <div class="flex justify-between items-start">
                            <h3 class="font-bold text-gray-800">N3: Formação Acadêmica</h3>
                            <span class="bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded-full">10 Pts</span>
                        </div>
                        <p class="text-sm text-gray-600 mt-2">5 pontos por Pós-graduação (Lato ou Stricto Sensu) na área de atuação. Stricto Sensu vale de qualquer período.</p>
                    </div>
                    <div id="destaque-n3" class="mt-3 pt-3 border-t border-gray-200 text-xs"></div>
                </div>
                
                <div class="bg-gray-50 rounded-lg p-4 flex flex-col justify-between" id="card-n4">
                   <div>
                        <div class="flex justify-between items-start">
                            <h3 class="font-bold text-gray-800">N4: Premiações</h3>
                            <span class="bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded-full">10 Pts</span>
                        </div>
                        <p class="text-sm text-gray-600 mt-2">5 pontos por premiação em concursos educacionais (SESI/SENAI ou outros). Válidos de 01/01/2023 a 30/09/2025.</p>
                    </div>
                    <div id="destaque-n4" class="mt-3 pt-3 border-t border-gray-200 text-xs"></div>
                </div>

                <div class="bg-gray-50 rounded-lg p-4 flex flex-col justify-between" id="card-n5">
                    <div>
                        <div class="flex justify-between items-start">
                            <h3 class="font-bold text-gray-800">N5: Participação em Concursos</h3>
                            <span class="bg-yellow-100 text-yellow-800 text-xs font-semibold px-2.5 py-0.5 rounded-full">5 Pts</span>
                        </div>
                        <p class="text-sm text-gray-600 mt-2">0,5 ponto por participação comprovada em concursos educacionais. Válidos de 01/01/2023 a 30/09/2025.</p>
                    </div>
                    <div id="destaque-n5" class="mt-3 pt-3 border-t border-gray-200 text-xs"></div>
                </div>

                <div class="bg-gray-50 rounded-lg p-4 flex flex-col justify-between" id="card-n6">
                    <div>
                        <div class="flex justify-between items-start">
                            <h3 class="font-bold text-gray-800">N6: Indicadores de Qualidade</h3>
                            <span class="bg-green-100 text-green-800 text-xs font-semibold px-2.5 py-0.5 rounded-full">20 Pts</span>
                        </div>
                        <p class="text-sm text-gray-600 mt-2">Pontuação única se a unidade atingir as metas: SENAI (IDAP ≥ 8.0 ou CI ≥ 4.0) e SESI (iSESI ≥ 6.0).</p>
                    </div>
                    <div id="destaque-n6" class="mt-3 pt-3 border-t border-gray-200 text-xs"></div>
                </div>

                <div class="bg-gray-50 rounded-lg p-4 flex flex-col justify-between" id="card-n7">
                    <div>
                        <div class="flex justify-between items-start">
                            <h3 class="font-bold text-gray-800">N7: Avaliação de Satisfação</h3>
                            <span class="bg-green-100 text-green-800 text-xs font-semibold px-2.5 py-0.5 rounded-full">15 Pts</span>
                        </div>
                        <p class="text-sm text-gray-600 mt-2">Pontuação única por resultado individual (SENAI) ou da escola (SESI) ≥ 90% na Avaliação de Reação ou CPA.</p>
                    </div>
                    <div id="destaque-n7" class="mt-3 pt-3 border-t border-gray-200 text-xs"></div>
                </div>
                
                <div class="bg-gray-50 rounded-lg p-4 flex flex-col justify-between" id="card-n8">
                    <div>
                        <div class="flex justify-between items-start">
                            <h3 class="font-bold text-gray-800">N8: Ações "Encantar para Avançar"</h3>
                            <span class="bg-yellow-100 text-yellow-800 text-xs font-semibold px-2.5 py-0.5 rounded-full">2.5 Pts</span>
                        </div>
                        <p class="text-sm text-gray-600 mt-2">0,5 ponto por atividade que conecta alunos à indústria (visitas, palestras, etc.), com limite de 2,5 pontos.</p>
                    </div>
                    <div id="destaque-n8" class="mt-3 pt-3 border-t border-gray-200 text-xs"></div>
                </div>

            </div>
        </div>
    </div>

    <script>
        const fullJsonData = {
          "records": [
            { "Ranking": 1, "Docente": "RENATA KELLY DE OLIVEIRA 8031", "Entidade": "SESI", "Unidade": "JAIARA - SESI", "Tempo de Casa": 4.5, "Pontuação\nN1": 10, "Pontuação\nN2": 10, "Pontuação\nN3": 10, "Pontuação\nN4": 10, "Pontuação\nN5": 4, "Pontuação\nN6": 20, "Pontuação\nN7": 0, "Pontuação\nN8": 2.5, "Total Geral": 66.5 },
            { "Ranking": 2, "Docente": "JULIO CESAR GAUDENCIO DE OLIVEIRA 6482", "Entidade": "SESI", "Unidade": "JAIARA - SESI", "Tempo de Casa": 7.7, "Pontuação\nN1": 9, "Pontuação\nN2": 10, "Pontuação\nN3": 10, "Pontuação\nN4": 10, "Pontuação\nN5": 4, "Pontuação\nN6": 20, "Pontuação\nN7": 0, "Pontuação\nN8": 2, "Total Geral": 65 },
            { "Ranking": 3, "Docente": "MARIA ZELIA DA SILVA MARIANO", "Entidade": "SENAI", "Unidade": "FATESG - SENAI", "Tempo de Casa": 13.3, "Pontuação\nN1": 10, "Pontuação\nN2": 7, "Pontuação\nN3": 10, "Pontuação\nN4": 0, "Pontuação\nN5": 0.5, "Pontuação\nN6": 20, "Pontuação\nN7": 15, "Pontuação\nN8": 0.5, "Total Geral": 63 },
            // This is a truncated list. In a real application, all 311 records would be here.
            { "Ranking": 4, "Docente": "VERANA GARCIA DE ARAUJO 2393", "Entidade": "SENAI", "Unidade": "FATESG - SENAI", "Tempo de Casa": 36.9, "Pontuação\nN1": 10, "Pontuação\nN2": 10, "Pontuação\nN3": 5, "Pontuação\nN4": 0, "Pontuação\nN5": 0.5, "Pontuação\nN6": 20, "Pontuação\nN7": 15, "Pontuação\nN8": 1.5, "Total Geral": 62 },
            { "Ranking": 5, "Docente": "ANA RAQUEL BARBOSA PATRIOTA", "Entidade": "SESI", "Unidade": "JD. COLORADO - SESI SENAI", "Tempo de Casa": 3.7, "Pontuação\nN1": 10, "Pontuação\nN2": 10, "Pontuação\nN3": 10, "Pontuação\nN4": 5, "Pontuação\nN5": 5, "Pontuação\nN6": 20, "Pontuação\nN7": 0, "Pontuação\nN8": 2, "Total Geral": 62 },
            { "Ranking": 6, "Docente": "SARA PEREIRA SILVA 4561", "Entidade": "SENAI", "Unidade": "ITUMBIARA - SENAI", "Tempo de Casa": 2.3, "Pontuação\nN1": 10, "Pontuação\nN2": 10, "Pontuação\nN3": 10, "Pontuação\nN4": 10, "Pontuação\nN5": 0.5, "Pontuação\nN6": 0, "Pontuação\nN7": 15, "Pontuação\nN8": 2, "Total Geral": 57.5 },
            { "Ranking": 7, "Docente": "LUDMILLA LETICIA CORREIA ALVES 9376", "Entidade": "SESI", "Unidade": "JAIARA - SESI", "Tempo de Casa": 2.7, "Pontuação\nN1": 10, "Pontuação\nN2": 10, "Pontuação\nN3": 0, "Pontuação\nN4": 10, "Pontuação\nN5": 4.5, "Pontuação\nN6": 20, "Pontuação\nN7": 0, "Pontuação\nN8": 2.5, "Total Geral": 57 },
            { "Ranking": 8, "Docente": "SILVIA LUDMILLA DE SOUZA ALVES ARAUJO 9352", "Entidade": "SESI", "Unidade": "JAIARA - SESI", "Tempo de Casa": 2.7, "Pontuação\nN1": 10, "Pontuação\nN2": 10, "Pontuação\nN3": 0, "Pontuação\nN4": 10, "Pontuação\nN5": 3.5, "Pontuação\nN6": 20, "Pontuação\nN7": 0, "Pontuação\nN8": 2.5, "Total Geral": 56 },
            { "Ranking": 9, "Docente": "NATHALIA MARTINS 8065", "Entidade": "SESI", "Unidade": "PLANALTO - SESI", "Tempo de Casa": 4.4, "Pontuação\nN1": 7, "Pontuação\nN2": 7, "Pontuação\nN3": 10, "Pontuação\nN4": 5, "Pontuação\nN5": 0.5, "Pontuação\nN6": 20, "Pontuação\nN7": 0, "Pontuação\nN8": 2.5, "Total Geral": 52 },
            { "Ranking": 10, "Docente": "MARCIO CARMONA COSTA", "Entidade": "SENAI", "Unidade": "ITUMBIARA - SENAI", "Tempo de Casa": 2.8, "Pontuação\nN1": 9, "Pontuação\nN2": 10, "Pontuação\nN3": 10, "Pontuação\nN4": 5, "Pontuação\nN5": 0.5, "Pontuação\nN6": 0, "Pontuação\nN7": 15, "Pontuação\nN8": 2, "Total Geral": 51.5 },
            { "Ranking": 11, "Docente": "IVONE BORGES SOUZA 3379", "Entidade": "SENAI", "Unidade": "FATESG - SENAI", "Tempo de Casa": 7.5, "Pontuação\nN1": 1, "Pontuação\nN2": 1, "Pontuação\nN3": 5, "Pontuação\nN4": 5, "Pontuação\nN5": 0, "Pontuação\nN6": 20, "Pontuação\nN7": 15, "Pontuação\nN8": 2.5, "Total Geral": 49.5 },
            { "Ranking": 12, "Docente": "OZIEL ROSA LEITE MILHOMEM 5961", "Entidade": "SESI", "Unidade": "CRIXÁS - SESI", "Tempo de Casa": 11.0, "Pontuação\nN1": 5, "Pontuação\nN2": 2, "Pontuação\nN3": 10, "Pontuação\nN4": 10, "Pontuação\nN5": 0.5, "Pontuação\nN6": 20, "Pontuação\nN7": 0, "Pontuação\nN8": 2, "Total Geral": 49.5 },
            { "Ranking": 13, "Docente": "JOSE LUCIANO CALIMAN 2899", "Entidade": "SENAI", "Unidade": "CELSO CHARURI - SESI SENAI", "Tempo de Casa": 11.4, "Pontuação\nN1": 10, "Pontuação\nN2": 10, "Pontuação\nN3": 10, "Pontuação\nN4": 0, "Pontuação\nN5": 0.5, "Pontuação\nN6": 0, "Pontuação\nN7": 15, "Pontuação\nN8": 2.5, "Total Geral": 48 },
            { "Ranking": 14, "Docente": "ALAN KARDEC AMARAL LOPES 9340", "Entidade": "SESI", "Unidade": "PLANALTO - SESI", "Tempo de Casa": 2.7, "Pontuação\nN1": 10, "Pontuação\nN2": 10, "Pontuação\nN3": 10, "Pontuação\nN4": 10, "Pontuação\nN5": 5, "Pontuação\nN6": 0, "Pontuação\nN7": 0, "Pontuação\nN8": 2.5, "Total Geral": 47.5 },
            { "Ranking": 15, "Docente": "KAREN HAYRON RESENDE DAMASCENO 4639", "Entidade": "SENAI", "Unidade": "ITUMBIARA - SENAI", "Tempo de Casa": 2.1, "Pontuação\nN1": 10, "Pontuação\nN2": 10, "Pontuação\nN3": 5, "Pontuação\nN4": 0, "Pontuação\nN5": 5, "Pontuação\nN6": 0, "Pontuação\nN7": 15, "Pontuação\nN8": 2, "Total Geral": 47 },
            { "Ranking": 16, "Docente": "ERICA SOARES TAVARES", "Entidade": "SESI", "Unidade": "CRIXÁS - SESI", "Tempo de Casa": 11.5, "Pontuação\nN1": 2, "Pontuação\nN2": 3, "Pontuação\nN3": 10, "Pontuação\nN4": 10, "Pontuação\nN5": 1.5, "Pontuação\nN6": 20, "Pontuação\nN7": 0, "Pontuação\nN8": 0.5, "Total Geral": 47 },
            { "Ranking": 17, "Docente": "JEAN CARLOS LEAL DA SILVA JUNIOR 9496", "Entidade": "SESI", "Unidade": "VILA CANAÃ - SESI", "Tempo de Casa": 2.6, "Pontuação\nN1": 6, "Pontuação\nN2": 3, "Pontuação\nN3": 10, "Pontuação\nN4": 5, "Pontuação\nN5": 0.5, "Pontuação\nN6": 20, "Pontuação\nN7": 0, "Pontuação\nN8": 2.5, "Total Geral": 47 },
            { "Ranking": 18, "Docente": "GEORDE DE MOURA GOMES 4763", "Entidade": "SESI", "Unidade": "UNIDIGITAL", "Tempo de Casa": 14.4, "Pontuação\nN1": 7, "Pontuação\nN2": 4, "Pontuação\nN3": 10, "Pontuação\nN4": 5, "Pontuação\nN5": 0.5, "Pontuação\nN6": 20, "Pontuação\nN7": 0, "Pontuação\nN8": 0.5, "Total Geral": 47 },
            { "Ranking": 19, "Docente": "ELIZETE TAVARES DE MELO MARIANO", "Entidade": "SESI", "Unidade": "VILA CANAÃ - SESI", "Tempo de Casa": 3.4, "Pontuação\nN1": 10, "Pontuação\nN2": 5, "Pontuação\nN3": 10, "Pontuação\nN4": 0, "Pontuação\nN5": 0, "Pontuação\nN6": 20, "Pontuação\nN7": 0, "Pontuação\nN8": 1.5, "Total Geral": 46.5 },
            { "Ranking": 20, "Docente": "KARINE SILVA DE BARROS 9531", "Entidade": "SESI", "Unidade": "CRIXÁS - SESI", "Tempo de Casa": 2.6, "Pontuação\nN1": 3, "Pontuação\nN2": 10, "Pontuação\nN3": 5, "Pontuação\nN4": 5, "Pontuação\nN5": 3, "Pontuação\nN6": 20, "Pontuação\nN7": 0, "Pontuação\nN8": 0.5, "Total Geral": 46.5 }
          ]
        };
        
        const scoreLabels = {
            'Pontuação\nN1': { label: 'Form. Continuada - UNINDÚSTRIA', id: 'n1' },
            'Pontuação\nN2': { label: 'Form. Continuada - Outras', id: 'n2' },
            'Pontuação\nN3': { label: 'Formação Acadêmica', id: 'n3' },
            'Pontuação\nN4': { label: 'Premiações em Concursos', id: 'n4' },
            'Pontuação\nN5': { label: 'Participação em Concursos', id: 'n5' },
            'Pontuação\nN6': { label: 'IDAP/iSESI', id: 'n6' },
            'Pontuação\nN7': { label: 'Avaliação Satisfação / NPS', id: 'n7' },
            'Pontuação\nN8': { label: 'Ações Encantar para Avançar', id: 'n8' },
        };
        
        let chart;
        let allProcessedData;
        let finalTop10List;

        document.addEventListener('DOMContentLoaded', () => {
            const allData = fullJsonData.records.sort((a, b) => a.Ranking - b.Ranking);
            
            finalTop10List = [];
            const unitCounter = {};
            let sesiCounter = 0;
            let senaiCounter = 0;
            
            for (const teacher of allData) {
                if (finalTop10List.length >= 10) break;
                const unit = teacher.Unidade;
                const entity = teacher.Entidade.trim();
                const isUnitLimitReached = (unitCounter[unit] || 0) >= 2;
                const isSesiLimitReached = entity === 'SESI' && sesiCounter >= 5;
                const isSenaiLimitReached = entity === 'SENAI' && senaiCounter >= 5;

                if (!isUnitLimitReached && !isSesiLimitReached && !isSenaiLimitReached) {
                    finalTop10List.push(teacher);
                    unitCounter[unit] = (unitCounter[unit] || 0) + 1;
                    if (entity === 'SESI') sesiCounter++;
                    else senaiCounter++;
                }
            }

            const finalTop10Rankings = new Set(finalTop10List.map(t => t.Ranking));

            allProcessedData = allData.map(teacher => {
                const isTop10 = finalTop10Rankings.has(teacher.Ranking);
                let status = 'Não Classificado';
                let reason = '';

                if (isTop10) {
                    status = 'TOP 10';
                    reason = 'Classificado nos critérios.';
                } else {
                    status = 'Desclassificado';
                    let reasons = [];
                    const tempUnitCounter = {};
                    let tempSesiCounter = 0;
                    let tempSenaiCounter = 0;
                    for (const t of finalTop10List) {
                        if (t.Ranking < teacher.Ranking) {
                           tempUnitCounter[t.Unidade] = (tempUnitCounter[t.Unidade] || 0) + 1;
                           if(t.Entidade.trim() === 'SESI') tempSesiCounter++;
                           else tempSenaiCounter++;
                        }
                    }
                    if ((tempUnitCounter[teacher.Unidade] || 0) >= 2) reasons.push('Limite por Unidade');
                    if (teacher.Entidade.trim() === 'SESI' && tempSesiCounter >= 5) reasons.push('Limite de vagas SESI');
                    if (teacher.Entidade.trim() === 'SENAI' && tempSenaiCounter >= 5) reasons.push('Limite de vagas SENAI');
                    if (reasons.length === 0) reasons.push('Pontuação insuficiente');
                    reason = reasons.join(' / ');
                }
                return { ...teacher, status, reason };
            });
            
            populateTeacherDatalist(fullJsonData.records);
            populateUnitFilter();
            populateIndividualTeacherSelector(allProcessedData);

            document.getElementById('unit-filter').addEventListener('change', updateView);
            document.getElementById('teacher-search').addEventListener('input', updateView);
            document.getElementById('individual-teacher-selector').addEventListener('change', (e) => {
                updateIndividualCard(e.target.value, allProcessedData);
            });


            updateView(); // Initial call
        });

        function populateTeacherDatalist(data) {
            const datalist = document.getElementById('teacher-datalist');
            // In a real app, this would be the full list of 311 teachers
            const uniqueTeachers = [...new Set(data.map(item => item.Docente))].sort();
            uniqueTeachers.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                datalist.appendChild(option);
            });
        }
        
        function populateIndividualTeacherSelector(data) {
            const selector = document.getElementById('individual-teacher-selector');
            data.sort((a, b) => a.Docente.localeCompare(b.Docente))
               .forEach(teacher => {
                   const option = document.createElement('option');
                   option.value = teacher.Docente;
                   option.textContent = teacher.Docente;
                   selector.appendChild(option);
               });
        }

        function updateIndividualCard(teacherName, data) {
            const container = document.getElementById('performance-card-container');
            if (!teacherName) {
                container.classList.add('hidden');
                container.innerHTML = '';
                return;
            }

            const teacherData = data.find(d => d.Docente === teacherName);
            if (!teacherData) {
                container.classList.add('hidden');
                return;
            }

            let cardHtml = `
                <div class="bg-white rounded-lg shadow-md p-6 border border-gray-200">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="text-xl font-bold text-gray-800">${teacherData.Docente}</h3>
                            <p class="text-sm text-gray-500">${teacherData.Unidade} / ${teacherData.Entidade.trim()}</p>
                        </div>
                        <div class="text-right">
                            <p class="text-sm font-semibold text-gray-500">Ranking Geral</p>
                            <p class="text-3xl font-bold text-indigo-600">${teacherData.Ranking}º</p>
                        </div>
                    </div>
                    <div class="mt-6 pt-4 border-t">
                        <h4 class="text-md font-semibold text-gray-700 mb-4">Pontuação por Indicador</h4>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">`;

            Object.keys(scoreLabels).forEach(key => {
                cardHtml += `
                    <div class="bg-gray-50 p-3 rounded-md">
                        <p class="font-semibold text-gray-600">${scoreLabels[key].label}</p>
                        <p class="text-2xl font-bold text-gray-800">${teacherData[key] || 0}</p>
                    </div>`;
            });

            cardHtml += `
                        </div>
                    </div>
                    <div class="mt-6 pt-4 border-t bg-gray-50 rounded-lg p-4 flex justify-between items-center">
                         <h4 class="text-lg font-bold text-gray-800">Total Geral</h4>
                         <p class="text-3xl font-extrabold text-indigo-600">${teacherData['Total Geral']}</p>
                    </div>
                </div>`;

            container.innerHTML = cardHtml;
            container.classList.remove('hidden');
        }
        
        function updateView() {
            const selectedUnit = document.getElementById('unit-filter').value;
            const searchQuery = document.getElementById('teacher-search').value.toLowerCase();

            // Filter data for cards and highlights
            let cardsAndHighlightsData = fullJsonData.records;
            if (selectedUnit !== 'all') {
                cardsAndHighlightsData = cardsAndHighlightsData.filter(d => d.Unidade === selectedUnit);
            }
            if (searchQuery) {
                cardsAndHighlightsData = cardsAndHighlightsData.filter(d => d.Docente.toLowerCase().includes(searchQuery));
            }
            calculateAndDisplayBigNumbers(cardsAndHighlightsData);
            highlightTopPerformers(cardsAndHighlightsData);

            // Filter data for the chart
            let chartData;
            const originalTop20Rankings = new Set(fullJsonData.records.slice(0, 20).map(d => d.Ranking));
            const finalTop10Rankings = new Set(finalTop10List.map(t => t.Ranking));
            
            if (selectedUnit === 'all' && !searchQuery) {
                // Default view: top 20 + winners from the entire dataset
                chartData = allProcessedData.filter(teacher => originalTop20Rankings.has(teacher.Ranking) || finalTop10Rankings.has(teacher.Ranking));
            } else {
                // Filtered view
                chartData = allProcessedData;
                if (selectedUnit !== 'all') {
                    chartData = chartData.filter(d => d.Unidade === selectedUnit);
                }
                if (searchQuery) {
                    chartData = chartData.filter(d => d.Docente.toLowerCase().includes(searchQuery));
                }
            }
            
            renderChart(chartData.sort((a,b) => a.Ranking - b.Ranking));
        }

        function calculateAndDisplayBigNumbers(data) {
            const selectedUnit = document.getElementById('unit-filter').value;
            const searchQuery = document.getElementById('teacher-search').value;
            const isFiltered = selectedUnit !== 'all' || searchQuery;

            const totalDocentes = isFiltered ? data.length : 311;
            
            let totalUnidades;
            if (isFiltered) {
                totalUnidades = new Set(data.map(item => item.Unidade)).size;
            } else {
                totalUnidades = new Set(fullJsonData.records.map(item => item.Unidade)).size;
            }
            
            const mediaUnidades = totalUnidades > 0 ? (totalDocentes / totalUnidades).toFixed(1) : '0.0';

            document.getElementById('total-docentes').textContent = totalDocentes;
            document.getElementById('total-unidades').textContent = totalUnidades;
            document.getElementById('media-unidades').textContent = mediaUnidades.replace('.', ',');
        }

        function populateUnitFilter() {
            const filter = document.getElementById('unit-filter');
            const unidades = [...new Set(fullJsonData.records.map(item => item.Unidade))].sort();
            unidades.forEach(unidade => {
                const option = document.createElement('option');
                option.value = unidade;
                option.textContent = unidade;
                filter.appendChild(option);
            });
        }

        function highlightTopPerformers(data) {
            Object.keys(scoreLabels).forEach(key => {
                const scoreKey = key;
                const indicatorId = scoreLabels[key].id;
                const container = document.getElementById(`destaque-${indicatorId}`);
                
                if (!container) return;
                
                if (data.length === 0) {
                    container.innerHTML = `<div class="flex items-center text-gray-500"><span class="font-bold">Destaque:</span> Nenhum docente encontrado.</div>`;
                    return;
                }

                const maxScore = Math.max(...data.map(d => d[scoreKey] || 0));
                
                if (maxScore === 0 && !data.some(d => d[scoreKey] === 0)) {
                     container.innerHTML = `<div class="flex items-center text-gray-500"><span class="font-bold">Destaque:</span> Nenhuma pontuação registrada.</div>`;
                     return;
                }

                const topPerformers = data.filter(d => d[scoreKey] === maxScore);
                const names = topPerformers.map(d => d.Docente.replace(/\s\d+$/, '').trim()).join(', ');

                container.innerHTML = `
                    <div class="flex items-center text-gray-700">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-500 mr-2 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                        </svg>
                        <div>
                            <span class="font-bold">Destaque:</span> ${names}
                            <span class="font-bold text-blue-600">(${maxScore.toLocaleString('pt-BR')} Pts)</span>
                        </div>
                    </div>
                `;
            });
        }

        function renderChart(data) {
            const seriesData = data.map(d => d['Total Geral']);
            const categoriesData = data.map(d => `[${d.status}] ${d.Ranking}º - ${d.Docente}`);
            const colors = data.map(item => {
                if (item.status === 'TOP 10') {
                    return item.Entidade.trim() === 'SESI' ? '#48BB78' : '#4299E1';
                }
                return '#A0AEC0';
            });

            const options = {
                series: [{ name: 'Pontuação Geral', data: seriesData }],
                chart: { type: 'bar', height: 800, toolbar: { show: false }, foreColor: '#374151' },
                plotOptions: { bar: { horizontal: true, borderRadius: 6, dataLabels: { position: 'top' }, distributed: true } },
                colors: colors,
                legend: { show: false },
                dataLabels: { enabled: true, offsetX: 30, style: { fontSize: '12px', colors: ['#374151'] }, formatter: val => val.toFixed(1) },
                xaxis: { categories: categoriesData, title: { text: 'Pontuação Geral', style: { fontSize: '14px', fontWeight: 600 } } },
                yaxis: { labels: { style: { fontSize: '11px' } } },
                grid: { borderColor: '#E5E7EB', xaxis: { lines: { show: true } }, yaxis: { lines: { show: false } }, padding: { left: 280 } },
                tooltip: {
                    theme: 'light',
                    custom: function({ series, seriesIndex, dataPointIndex, w }) {
                        const tooltipData = data[dataPointIndex];
                        if (!tooltipData) return '';

                        let statusColor = 'text-gray-500';
                        if (tooltipData.status === 'TOP 10') statusColor = 'text-green-600';
                        if (tooltipData.status === 'Desclassificado') statusColor = 'text-yellow-600';

                        let tooltipHtml = `<div class="p-2"><div class="font-bold mb-2">${tooltipData.Docente}</div><div class="tooltip-grid mb-2 pb-2 border-b border-gray-200">
                                    <div class="tooltip-label">Status:</div><div class="tooltip-value ${statusColor}">${tooltipData.status}</div>
                                    ${tooltipData.status === 'Desclassificado' ? `<div class="tooltip-label">Motivo:</div><div class="tooltip-value">${tooltipData.reason}</div>` : ''}
                                    <div class="tooltip-label">Entidade:</div><div class="tooltip-value">${tooltipData.Entidade}</div>
                                    <div class="tooltip-label">Unidade:</div><div class="tooltip-value">${tooltipData.Unidade}</div>
                                    <div class="tooltip-label">Tempo de Casa:</div><div class="tooltip-value">${tooltipData['Tempo de Casa'].toFixed(1)} anos</div>
                                </div><div class="tooltip-grid pt-2">`;
                        
                        Object.keys(scoreLabels).forEach(key => {
                            tooltipHtml += `<div class="tooltip-label">${scoreLabels[key].label}:</div><div class="tooltip-value">${tooltipData[key] || 0}</div>`;
                        });
                        
                        tooltipHtml += `<div class="tooltip-label border-t border-gray-200 pt-1 mt-1">Total Geral:</div><div class="tooltip-value font-bold border-t border-gray-200 pt-1 mt-1">${tooltipData['Total Geral']}</div></div></div>`;
                        return tooltipHtml;
                    }
                },
                noData: { text: 'Nenhum dado encontrado para a seleção atual.' },
            };

            if (chart) {
                chart.updateOptions(options);
            } else {
                chart = new ApexCharts(document.querySelector("#chart"), options);
                chart.render();
            }
        }
    </script>
</body>
</html>

